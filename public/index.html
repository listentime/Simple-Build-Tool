<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.js"></script>
  <style>
    #app {
      width: 1200px;
      height: 800px;
      overflow: scroll;
      margin: 0 auto;
      background-color: black;
      padding: 20px;
      color: aliceblue;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <!-- è¾“å…¥é¡¹ç›®çš„è·¯å¾„ -->
  <input type="text" value="/Users/fic/Desktop/my-app" id="dirPath">
  <button id="buildSubmit">æ„å»º</button>
  <div id="app">
    <!-- è¾“å‡ºå†…å®¹çš„è½½ä½“ -->
    <div><code id="content" class="content"></code></div>
    <div style="color:#f1ac0c;word-wrap:break-all;"><code id="warning"></code></div>
    <div style="color:red;word-wrap:break-all;"><code id="error"></code></div>
  </div>
  <script>
    let buildSubmit = document.getElementById( 'buildSubmit' )
    let app = document.getElementById( 'content' )
    let dirPath = document.getElementById( 'dirPath' )
    let error = document.getElementById( 'error' )
    let warning = document.getElementById( 'warning' )

    // é€šè¿‡ new EventSource å¼€å¯ SSE
    const source = new EventSource( `http://127.0.0.1:3001/api/log/push` );
    // ç›‘å¬ message äº‹ä»¶
    source.onmessage = event => {
      app.innerHTML += `${ event.data }</br>`
    }
    source.addEventListener( 'warning', event => {
      warning.innerHTML += `âš ï¸:${ event.data }</br>`
    }, false )
    source.addEventListener( 'stop', event => {
      app.innerHTML += `${ event.data }</br>`
      source.close()
    }, false )
    source.addEventListener( 'error', event => {
      error.innerHTML += `ğŸ™…:${ event.data }</br>`
      source.close()
    }, false )
    buildSubmit.onclick = () => {
      // æ„å»ºä¹‹å‰æ¸…ç©ºè½½ä½“
      app.innerHTML = '';
      error.innerHTML = '';
      warning.innerHTML = '';
      const projectPath = dirPath.value;
      // åšäº†ä¸ªç®€å•æ ¡éªŒ
      if ( !projectPath ) {
        error.innerHTML += 'ğŸ™…:ç›®æ ‡æ‰“åŒ…è·¯å¾„ä¸èƒ½ä¸ºç©º</br>'
        return
      }
      // å‘èµ·è¯·æ±‚
      $.ajax( {
        url: 'http://127.0.0.1:3001/api/project/build',
        method: 'post',
        data: {
          projectPath // é¡¹ç›®è·¯å¾„
        },
        // æˆåŠŸå›è°ƒ
        success: res => {
          app.innerHTML += `${ res.msg }</br>`
        }
      } )
    }
  </script>
</body>

</html>